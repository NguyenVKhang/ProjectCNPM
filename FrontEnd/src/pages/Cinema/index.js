import "./style.css"
import { Swiper, SwiperSlide } from "swiper/react";
import Tab from "react-bootstrap/Tab";
import Tabs from "react-bootstrap/Tabs";
import { useState, useEffect } from "react";
import { useNavigate } from "react-router-dom";

import "swiper/css";
import "swiper/css/navigation";
import "swiper/css/pagination";
import { Autoplay, Navigation, Pagination } from "swiper";
function Cinema() {
    const [Cinema, setCinema] = useState([]);
    const [Cinplex, setCinplex] = useState('');
    const [province, setProvince] = useState('');
    const [movie, setMovie] = useState('');



    const chooseProvince = (e) => {
        setProvince(e.target.innerText);
        setCinplex('');
        //find the active class and remove it, add active to the class that is being clicked
        const active = document.querySelector('.siteactive');
        if (active) {
            active.classList.remove('siteactive');
        }
        e.target.classList.add('siteactive');

        const cinplexactive = document.querySelector('.cinplexactive');
        if (cinplexactive) {
            cinplexactive.classList.remove('cinplexactive');
        }

        const theaterContainer = document.querySelector('.theater-container');
        theaterContainer.style.display = 'none';
    }

    const chooseCinplex = (e) => {
        setCinplex(e.target.innerText);
        //theater-container display none
        const active = document.querySelector('.cinplexactive');
        if (active) {
            active.classList.remove('cinplexactive');
        }
        e.target.classList.add('cinplexactive');
        const theaterContainer = document.querySelector('.theater-container');
        theaterContainer.style.display = 'block';

        document.querySelector('.theater-title h3').innerHTML = e.target.innerText;

        fetch("http://localhost:3001/movie/getMovieByCinplex", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                cinplex: e.target.innerText,
                place: province
            }),
        })
            .then((res) => res.json())
            .then((data) => {
                console.log(data.data.movieByCinplex);
                setMovie(data.data.movieByCinplex)
            }
            )
            .catch((err) => {
                console.log(err);
            }
            );
    }

    useEffect(() => {
        fetch("http://localhost:3001/cinema/getAllCinema", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((res) => res.json())
            .then((data) => {
                setCinema(data.data.cinema);
            })
            .catch((err) => {
                console.log(err);
            });
    }, []);


    const navigate = useNavigate();
    const showDetailMovie = (e) => {
        const name = e.target.title
        fetch('http://localhost:3001/movie/getdetailnow', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ name: name }),
        })
            .then((res) => res.json())
            .then((data) => {
                navigate(`/movie/${data.data.movie.title}`, { state: data.data.movie })
            })
            .catch((err) => {
                console.log(err);
            });
    }



    const user = JSON.parse(localStorage.getItem('token'));
    const testClick = (e) => {
        if (!user) {
            window.location.href = "/login";
            return;
        }
        //get atribute name
        const name = e.target.getAttribute('name');
        const day = e.target.getAttribute('date');
        const location = province
        const type = e.target.getAttribute('type');
        const cinema = Cinplex;
        const site = e.target.getAttribute('site');
        const time = e.target.getAttribute('time');

        fetch('http://localhost:3001/movie/getposition', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ name: name, day: day, location: location, type: type, cinema: cinema, site: site, time: time }),
        })
            .then((res) => res.json())
            .then((data) => {
                navigate('/ticket', { state: data.data })
            });
    }


    return (
        <div className="main-container" id="all_cinema">
            <div className="main">
                <div className="col-main">
                    <div className="showtimes-wrap">
                        <div className="showtimes-container">
                            <div className="theatre-wrap">
                                <div className="theatre-list product-view">
                                    <div className="cgv-showtime-top"></div>
                                    <div className="theatre-city-tabs cgv-showtime-center">
                                        <div className="content-list-cinema">
                                            <div className="title-cgv-cinema">
                                                <h1>CGV CINEMAS</h1>
                                            </div>
                                            <div className="cinemas-area">
                                                <ul>
                                                    {Cinema.map((Province, index) => {
                                                        return (
                                                            <li key={index} >
                                                                <span cursorshover="true" onClick={chooseProvince}>
                                                                    {Province.province}
                                                                </span>
                                                            </li>
                                                        );
                                                    })}
                                                </ul>

                                            </div>
                                            <div className="cinemas-list">
                                                <ul>
                                                    {province === '' ? null : Cinema.find((Province) => Province.province === province).cinema.map((theater, index) => {
                                                        return (
                                                            <li key={index}>
                                                                <span onClick={chooseCinplex}>{theater.cinema_name} </span>
                                                            </li>
                                                        );
                                                    })}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="cgv-showtime-bottom"></div>
                                </div>


                                <div className="theater-container product-view" >
                                    <div className="heater-head">
                                        <div className="home-title">
                                            <h3>Ráº¡p</h3>
                                        </div>
                                        <div className="page-title theater-title" >
                                            <h3></h3>
                                        </div>
                                    </div>
                                    <div className="theater-gallery">
                                        <div className="theater-thumb-image">
                                            <div className="slideshow-theater slideshow-container">
                                                <Swiper
                                                    slidesPerView={1}
                                                    spaceBetween={30}
                                                    loop={true}
                                                    autoplay={{
                                                        delay: 3500,
                                                        disableOnInteraction: false,
                                                    }}
                                                    navigation={true}
                                                    modules={[Autoplay, Pagination, Navigation]}
                                                    className="mySwiper">
                                                    <SwiperSlide className="swiper-slide">
                                                        <a href="">
                                                            <img
                                                                src="https://www.cgv.vn/media/site/cache/1/980x415/b58515f018eb873dafa430b6f9ae0c1e/i/m/img_2893a_2_1.jpg"
                                                                alt="" />
                                                        </a>
                                                    </SwiperSlide>
                                                    <SwiperSlide className="swiper-slide">
                                                        <a href="">
                                                            <img
                                                                src="https://www.cgv.vn/media/site/cache/1/980x415/b58515f018eb873dafa430b6f9ae0c1e/i/m/img_0027_2a_2_1.jpg"
                                                                alt="" />
                                                        </a>
                                                    </SwiperSlide>
                                                    <SwiperSlide className="swiper-slide">
                                                        <a href="">
                                                            <img
                                                                src="https://www.cgv.vn/media/site/cache/1/980x415/b58515f018eb873dafa430b6f9ae0c1e/i/m/img_9935_2a_2_1.jpg"
                                                                alt="" />
                                                        </a>
                                                    </SwiperSlide>
                                                    <SwiperSlide className="swiper-slide">
                                                        <a href="">
                                                            <img
                                                                src="https://www.cgv.vn/media/site/cache/1/980x415/b58515f018eb873dafa430b6f9ae0c1e/i/m/img_2915a_2_1.jpg"
                                                                alt="" />
                                                        </a>
                                                    </SwiperSlide>
                                                </Swiper>
                                            </div>
                                        </div>
                                        <div className="theater-infomation">
                                            <div className="left-info-theater">
                                                <div className="theater-left-content">
                                                    <div className="theater-address">
                                                        {Cinplex === '' ? null : Cinema.find((Province) => Province.province === province).cinema.find((theater) => theater.cinema_name === Cinplex).address}
                                                    </div>
                                                    <div className="fax">
                                                        <label>Fax : </label>
                                                        <div className="fax-input" style={{ display: 'inline' }}>
                                                            +84 4 6 275 5240
                                                        </div>
                                                    </div>
                                                    <div className="hotline">
                                                        <label >Hotline : </label>
                                                        <div className="fax-input" style={{ display: 'inline' }}>
                                                            1900 6017
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="right-info-theater">
                                                <div className="theater-right-content">
                                                    <div className="location">
                                                        <a className="iframe cboxElement" title="CGV HÃ¹ng VÆ°Æ¡ng Plaza" href="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1959.8605272140667!2d106.66259586811066!3d10.755968268574438!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752ef08a32cf6f%3A0x796d8897cb4e6b59!2sCGV+Hung+Vuong+Plaza!5e0!3m2!1sen!2s!4v1423115214982" >
                                                            Xem báº£n Äá»</a>
                                                    </div>
                                                    <div className="contact-us">
                                                        <a className="cotact-us-link" href="https://www.cgv.vn/default/contacts/" >
                                                            LiÃªn há» CGV
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="product-collateral toggle-content tabs tabs-format-cgv cgv-schedule-v2">
                                        <div className="tabs">
                                            <Tabs
                                                defaultActiveKey="time"
                                                variant="pills"
                                                id="uncontrolled-tab-example"
                                                className="mb-3 tabss">
                                                <Tab eventKey="time" title="Lá»ch chiáº¿u phim hÃ´m nay">
                                                    <div className="tab-content">
                                                        <div className="product-collateral tabs tabs-cgv-showtimes">
                                                            {movie === '' ? null : movie.map((Movie, index) => {
                                                                return (
                                                                    <div className="film-list" key={index}>
                                                                        <div className="film-label">
                                                                            <h3 >
                                                                                <a style={{ 'cursor': 'pointer' }} title={Movie.name} onClick={showDetailMovie} >
                                                                                    {Movie.name}
                                                                                </a>
                                                                            </h3>
                                                                        </div>
                                                                        <div className="film-left">
                                                                            <div className="film-poster">
                                                                                <a style={{ 'cursor': 'pointer' }}><img src={Movie.image} width="190" height="250" onClick={showDetailMovie} title={Movie.name} /></a>
                                                                            </div>
                                                                        </div>
                                                                        <div className="film-right">
                                                                            {Movie.type.flatMap((Type) => Type.Cinema[0].Site.map((Site) => {
                                                                                return (
                                                                                    <div style={{
                                                                                        'marginLeft': '10px',
                                                                                        'marginBottom': '60px',
                                                                                    }}>
                                                                                        <strong className="film-screen std">
                                                                                            {Type.type_name} | {Site.site_name}
                                                                                        </strong>
                                                                                        <div className="film-showtimes">
                                                                                            <ul className="products-girl-movie tab-showtime">
                                                                                                {Site.Time.map((Time, index) => {
                                                                                                    const date = new Date(Time.timeSt);
                                                                                                    return (
                                                                                                        <li className="item" key={index}>
                                                                                                            <span style={{ 'cursor': 'pointer' }} onClick={testClick} name={Movie.name} date={Movie.day} type={Type.type_name} site={Site.site_name} time={Time.timeSt}>
                                                                                                                {date.toLocaleTimeString("en-US", { hour: '2-digit', minute: '2-digit' })}
                                                                                                            </span>
                                                                                                        </li>
                                                                                                    )
                                                                                                })}
                                                                                            </ul>
                                                                                        </div>
                                                                                    </div>
                                                                                )
                                                                            }))}
                                                                        </div>
                                                                    </div>
                                                                )
                                                            })}
                                                        </div>
                                                    </div>
                                                </Tab>
                                                <Tab eventKey="ticket_price" title="GiÃ¡ vÃ© phim">
                                                    <div className="tab-content">
                                                        <div className="information-ticket-new">
                                                            <div className="u22-price">
                                                                <h3>u22</h3>
                                                            </div>
                                                            <div className="box-table-price">
                                                                <div className="title-table-price">
                                                                    <h2>Báº¢NG GIÃ VÃ</h2>
                                                                </div>
                                                                <table border="1">
                                                                    <tbody>
                                                                        <tr className="title-day">
                                                                            <td>
                                                                                <p>Tá»« thá»© hai Äáº¿n thá»© sÃ¡u</p>
                                                                            </td>
                                                                            <td colSpan="3">
                                                                                <p>thá»© hai, thá»© ba, thá»© nÄm</p>
                                                                            </td>
                                                                            <td className="w12-5" rowSpan="2">
                                                                                <p>thá»© tÆ° vui váº»</p>
                                                                            </td>
                                                                            <td colSpan="3">
                                                                                <p>thá»© sÃ¡u, thá»© báº£y,chá»§ nháº­t vÃ  ngÃ y lá»</p>
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td className="w12-5">
                                                                                <p>ThÃ nh ViÃªn Tá»« 22 Tuá»i Trá» Xuá»ng, Sá» Há»¯u Tháº» U22, Táº¡i Ráº¡p</p>
                                                                            </td>
                                                                            <td className="w12-5">
                                                                                <p>tráº» em</p>
                                                                            </td>
                                                                            <td className="w12-5">
                                                                                <p>Há»c sinh, sinh viÃªn, ngÆ°á»i cao tuá»i</p>
                                                                            </td>
                                                                            <td className="w12-5">
                                                                                <p>ngÆ°á»i lá»n</p>
                                                                            </td>
                                                                            <td className="w12-5">
                                                                                <p>tráº» em</p>
                                                                            </td>
                                                                            <td className="w12-5">
                                                                                <p>há»c sinh, sinh viÃªn (trÆ°á»c 17:00), ngÆ°á»i cao tuá»i</p>
                                                                            </td>
                                                                            <td className="w12-5">
                                                                                <p>ngÆ°á»i lá»n</p>
                                                                            </td>
                                                                        </tr>
                                                                        <tr className="value">
                                                                            <td>65.000</td>
                                                                            <td>70.000</td>
                                                                            <td>80.000</td>
                                                                            <td>100.000</td>
                                                                            <td>75.000</td>
                                                                            <td>80.000</td>
                                                                            <td>90.000</td>
                                                                            <td>120.000</td>
                                                                        </tr>
                                                                        <tr className="sur">
                                                                            <td colSpan="8">
                                                                                <p className="title-surcharge">
                                                                                    <strong>PHá»¤ THU:</strong>
                                                                                </p>
                                                                                <ul className="price-sub-table">
                                                                                    <li className="sub-charge">
                                                                                        <p>Gháº¿ VIP:</p>
                                                                                        +5.000 ( miá»n phá»¥ thu cho U22 )

                                                                                    </li>
                                                                                    <li className="sub-charge">
                                                                                        <p>Atmos:</p>
                                                                                        +15.000

                                                                                    </li>
                                                                                    <li className="sub-charge">
                                                                                        <p>Sweetbox :</p>
                                                                                        <ul>
                                                                                            <li>+25.000 (Thá»© Hai, Thá»© Ba, Thá»© NÄm, Thá»© SÃ¡u, Thá»© Báº£y, Chá»§ Nháº­t )</li>
                                                                                            <li>+15.000 (Thá»© TÆ° )</li>
                                                                                        </ul>
                                                                                    </li>
                                                                                    <li className="sub-charge">
                                                                                        <p>3D :</p>
                                                                                        <ul>
                                                                                            <li>+30.000 (Thá»© Hai, Thá»© Ba, Thá»© NÄm, Thá»© TÆ°)</li>
                                                                                            <li>+50.000 (Thá»© SÃ¡u, Thá»© Báº£y, Chá»§ Nháº­t vÃ  NgÃ y Lá» )</li>
                                                                                        </ul>
                                                                                    </li>
                                                                                    <li className="sub-charge">
                                                                                        <p>Lá»/Táº¿t:</p>
                                                                                        <ul>
                                                                                            <li>+10.000</li>
                                                                                        </ul>
                                                                                    </li>
                                                                                </ul>
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                            <div className="box-table-price">
                                                                <div className="title-table-price">
                                                                    <h2>Báº¢NG GIÃ VÃ 4DX</h2>
                                                                </div>
                                                                <table border="1">
                                                                    <tbody>
                                                                        <tr className="title-day">
                                                                            <td className="w9" rowSpan="2">&nbsp;</td>

                                                                            <td className="w36" colSpan="1">
                                                                                <p>thá»© hai, thá»© ba, thá»© nÄm</p>
                                                                            </td>
                                                                            <td className="w9" colSpan="1">
                                                                                <p>thá»© tÆ°

                                                                                    <br /> vui váº»

                                                                                </p>
                                                                            </td>
                                                                            <td className="w36" colSpan="1">
                                                                                <p>thá»© sÃ¡u, thá»© báº£y,

                                                                                    <br /> chá»§ nháº­t vÃ  ngÃ y lá»

                                                                                </p>
                                                                            </td>
                                                                        </tr>
                                                                        <tr className="title-time">

                                                                        </tr>
                                                                        <tr className="value-1">
                                                                            <td className="text">
                                                                                <p style={{ fontSize: '12px' }}>phim 3D</p>
                                                                            </td>

                                                                            <td>
                                                                                <p>200.000</p>
                                                                            </td>
                                                                            <td>
                                                                                <p>200.000</p>
                                                                            </td>
                                                                            <td>
                                                                                <p>240.000</p>
                                                                            </td>
                                                                        </tr>
                                                                        <tr className="value-1">
                                                                            <td className="text">
                                                                                <p style={{ fontSize: '12px' }}>phim 2D</p>
                                                                            </td>

                                                                            <td>
                                                                                <p>170.000</p>
                                                                            </td>
                                                                            <td>
                                                                                <p>170.000</p>
                                                                            </td>
                                                                            <td>
                                                                                <p>190.000</p>
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                            <div className="box-table-price">
                                                                <div className="title-table-price">
                                                                    <h2>Báº¢NG GIÃ VÃ SCREENX</h2>
                                                                </div>
                                                                <table border="1">
                                                                    <tbody>
                                                                        <tr className="title-day">
                                                                            <td className="w9" rowSpan="2">&nbsp;</td>

                                                                            <td className="w36" colSpan="1">
                                                                                <p>thá»© hai, thá»© ba, thá»© nÄm</p>
                                                                            </td>
                                                                            <td className="w9" colSpan="1">
                                                                                <p>thá»© tÆ°

                                                                                    <br /> vui váº»

                                                                                </p>
                                                                            </td>
                                                                            <td className="w36" colSpan="1">
                                                                                <p>thá»© sÃ¡u, thá»© báº£y,

                                                                                    <br /> chá»§ nháº­t vÃ  ngÃ y lá»

                                                                                </p>
                                                                            </td>
                                                                        </tr>
                                                                        <tr className="title-time">

                                                                        </tr>
                                                                        <tr className="value-1">
                                                                            <td className="text">
                                                                                <p style={{ fontSize: '12px' }}>phim 3D</p>
                                                                            </td>

                                                                            <td>
                                                                                <p>150.000</p>
                                                                            </td>
                                                                            <td>
                                                                                <p>150.000</p>
                                                                            </td>
                                                                            <td>
                                                                                <p>190.000</p>
                                                                            </td>

                                                                        </tr>
                                                                        <tr className="value-1">
                                                                            <td className="text">
                                                                                <p style={{ fontSize: '12px' }}>phim 2D</p>
                                                                            </td>

                                                                            <td>
                                                                                <p>120.000</p>
                                                                            </td>
                                                                            <td>
                                                                                <p>120.000</p>
                                                                            </td>
                                                                            <td>
                                                                                <p>140.000</p>
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>

                                                            <div className="goldlass-price-new">
                                                                <h3>goldlass</h3>
                                                            </div>
                                                            <div className="notice-info-ticket">
                                                                <h3>
                                                                    <strong>LÆ°u Ã½ :</strong>
                                                                </h3>
                                                                <ul>
                                                                    <li>- DÃ nh cho khÃ¡ch hÃ ng táº¡i ráº¡p L'amour (Goldclass), buffet khÃ´ng giá»i háº¡n ÄÆ°á»£c phá»¥c vá»¥ táº¡i buffet counter trong 30 phÃºt bao gá»m: 20 phÃºt Äáº§u phim (10 phÃºt trÆ°á»c khi phim chiáº¿u vÃ  tiáº¿p tá»¥c trong 10 phÃºt sau khi phim báº¯t Äáº§u chiáº¿u) vÃ  10 phÃºt giá»¯a phim.</li>
                                                                    <li>- Vui lÃ²ng xuáº¥t trÃ¬nh tháº» thÃ nh viÃªn CGV trÆ°á»c khi mua vÃ© Äá» ÄÆ°á»£c tÃ­ch Äiá»m.</li>
                                                                    <li>- GiÃ¡ vÃ© khi Äáº·t vÃ© trá»±c tuyáº¿n trÃªn website vÃ  á»©ng dá»¥ng CGV lÃ  giÃ¡ vÃ© ngÆ°á»i lá»n. CÃ¡c loáº¡i vÃ© nhÆ° há»c sinh-sinh viÃªn, vÃ© tráº» em, vÃ© ngÆ°á»i cao tuá»i, vÃ© U22 vui lÃ²ng mua trá»±c tiáº¿p táº¡i quáº§y.</li>
                                                                    <li>- VÃ© tráº» em chá» xuáº¥t khi cÃ³ sá»± hiá»n diá»n cá»§a tráº» dÆ°á»i 1m3 vÃ  trÃªn 2 tuá»i.</li>
                                                                    <li>- VÃ© ngÆ°á»i cao tuá»i chá» dÃ nh cho khÃ¡ch hÃ ng tá»« 55 tuá»i trá» lÃªn. Vui lÃ²ng xuáº¥t trÃ¬nh CMND khi mua vÃ©.</li>
                                                                    <li>- Vui lÃ²ng xuáº¥t trÃ¬nh tháº» há»c sinh-sinh viÃªn Äá» mua vÃ© Æ°u ÄÃ£i.</li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </Tab>
                                            </Tabs>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

        </div >
    )
}
export default Cinema;
